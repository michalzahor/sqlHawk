<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="rebuild" name="SchemaSpy">
  <property name="dest" value="output"/>
  <property name="dist" value="dist"/>
  <property name="src" value="src"/>
  <path id="project.class.path">
    <pathelement location="${dest}"/>
  </path>
  <!--Patternset to exclude files from the output directory:-->
  <patternset id="dest.exclude">
    <exclude name="package cache/"/>
    <exclude name="dependency cache/"/>
  </patternset>
  <target name="archive" depends="resource">
    <jar compress="true" destfile="${dist}/sqlHawk-${git.version}.jar" manifest="${src}/META-INF/MANIFEST.MF">
      <fileset dir="${dest}">
        <patternset refid="dest.exclude"/>
        <include name="**/*.*"/>
      </fileset>
      <manifest>
        <attribute name="Main-Class" value="net.sourceforge.schemaspy.Main"/>
      	<attribute name="Implementation-Version" 
      	                     value="${version}"/> 
      </manifest>
    </jar>
    <jar compress="true" destfile="${dist}/sqlHawk-${git.version}_source.jar">
      <fileset dir="${src}"/>
    </jar>
  </target>
  <target name="clean">
    <delete dir="${dist}" includeEmptyDirs="true" failonerror="false"/>
    <delete dir="${dest}" includeEmptyDirs="true" failonerror="false"/>
  </target>
  <target name="resource">
    <copy todir="${dest}">
      <fileset dir="${src}">
        <include name="**/*.properties"/>
        <include name="**/*.css"/>
        <include name="**/*.gif"/>
        <include name="**/*.js"/>
        <include name="**/*.xsd"/>
        <include name="**/*.rev"/>
      </fileset>
    </copy>
  </target>
  <target name="javadoc"/>
  <target name="compile" depends="init">
    <javac srcdir="${src}"
      includes="**/*.java"
      excludes="test/**"
      destdir="${dest}"
      debug="on"
      debuglevel="source,lines"
      source="1.5"
      target="1.5"
    />
  </target>

  <target name="revision" >
    <exec executable="git" outputproperty="git.version">
      <arg value="describe"/>
    </exec>
    <exec executable="git" outputproperty="git.date">
      <arg value="log"/>
        <arg value="--pretty=%ci"/>
        <arg value="-n 1"/>
      <arg value="HEAD"/>
    </exec>
    <property name="version" value="${git.version} ${git.date}"/>
  </target>

  <target name="make" depends="compile,revision,archive"/>
  <target name="rebuild" depends="clean,make"/>
  <target name="init">
    <mkdir dir="${dest}"/>
    <mkdir dir="${dist}"/>
  </target>
</project>
